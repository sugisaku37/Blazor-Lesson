@page "/counter"

<PageTitle>Counter</PageTitle>

<h1>Counter</h1>

@inject Microsoft.AspNetCore.Components.Server.ProtectedBrowserStorage.ProtectedSessionStorage storage
@inject NavigationManager navi

@if(currentCount.HasValue)
{
    <p role="status">Current count: @currentCount</p>
    <button class="btn btn-primary" @onclick="IncrementCount">増やす</button>
    <button class="btn btn-secondary" @onclick="MoveToNextPage">次のページへ</button>
}
else
{
    <p>Loading...</p>
}

@code {
    private int? currentCount = 0;
    private bool isInitialized = false;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            var result = await storage.GetAsync<int>("CurrentCount");
            currentCount = result.Success ? result.Value : 0;
            isInitialized = true;
            StateHasChanged();
        }
    }

    private async Task IncrementCount()
    {
        if (isInitialized)
        {
            currentCount++;
            await storage.SetAsync("CurrentCount", currentCount!.Value);
        }
    }

    private void MoveToNextPage()
    {
        navi.NavigateTo("/counter2");
    }
}
